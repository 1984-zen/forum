<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    {% load static %}
    <link rel="stylesheet" href="{% static 'css/bootstrap.min.css' %}">
    <title>LabelMe</title>
</head>

<body>
    <div class="container">
        <!-- start here -->
        {% if messages %}
        <div class="alert alert-warning" role="alert" style="text-align: center;">
          {% for message in messages %}
          {{ message }}
          {% endfor %}
        </div>
        {% endif %}

        <ol class="breadcrumb my-4">
            <li class="breadcrumb-item">LabelMe</li>
        </ol>

        {% if not user_name %}
        <span>please <a href="{% url 'login' %}">login</a></span>
        {% else %}
        <span><a href="{% url 'logout' %}">log out</a></span>
        {% endif %}
        <h2>Hi! Wellcome {{ user_name|default:'Guest' }}</h2>
    
        <br>
    
        {% regroup labels by input_img as labels_by_input_img_id %}
        <div>
            <li style="float: right;">下載全部的npy檔案(<a href="{{ npz_file | default:'' }}">.npz下載</a>)</li>
        </div>
        <table style="width:100%;" border="1">
            <thead>
                <tr>
                    <th style="width:1%; padding-left: 10pt; padding-right: 10pt; text-align: center;">SN</th>
                    <th style="text-align: center;">Image name</th>
                    <th style="text-align: center;">Label name</th>
                    <th style="text-align: center;">npy file</th>
                </tr>
            </thead>
            <tbody>
                {% for labels in labels_by_input_img_id %}
                {% for label in labels.list %}
                <tr>
                    {% if forloop.first %}
                        {% if forloop.parentloop.first %}
                        <td rowspan="{{ labels.list|length }}" style="width:1%; padding-left: 10pt; padding-right: 10pt; text-align: center;">{{ forloop.counter }}</td>
                        {% endif %}
                        <td style="text-align: center; width:30%; padding-left: 10pt; padding-right: 10pt;" rowspan="{{ labels.list|length }}">
                            <a href='{{ LABELME_URL }}?collection=LabelMe&mode=c&folder=example_folder&image={{ labels.grouper }}&username={{ user_name }}' target=_blank>{{ labels.grouper }}</a>
                        </td>
                    {% endif %}
                    <td style="text-align: left; width:60%; padding-left: 10pt; padding-right: 10pt;">
                        <img src="{{ MEDIA_URL }}{{ label.mask_path }}" width='50'> {{ label.label_name }}
                    </td>
                    <td>
                        <a href="/media/{{ label.npy_path }}"><span>npy下載</span></a>
                    </td>
                </tr>
                {% endfor %}
                {% endfor %}
            </tbody>
    </div> <!-- end here -->
</body>

</html>